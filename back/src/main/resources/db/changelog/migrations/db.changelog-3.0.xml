<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.9.xsd">

    <!-- Ampliar coluna discount_coupon de 7 para 20 caracteres -->
    <changeSet id="3.0-alter-sale-discount-coupon" author="gobarber">
        <modifyDataType tableName="sale" columnName="discount_coupon" newDataType="VARCHAR(20)"/>
    </changeSet>

    <!-- ==========================================
         Seed Data: Dados iniciais para desenvolvimento
         ========================================== -->
    <changeSet id="3.0-seed-addresses" author="gobarber" context="dev">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM address WHERE id_adress = 1</sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO address (id_adress, street, number, neighborhood, city, state, cep) VALUES
            (1, 'Rua das Flores', 123, 'Centro', 'Recife', 'PE', '5001000'),
            (2, 'Av. Boa Viagem', 456, 'Boa Viagem', 'Recife', 'PE', '5102010'),
            (3, 'Rua do Sol', 789, 'Santo Antônio', 'Recife', 'PE', '5001020'),
            (4, 'Av. Conselheiro Aguiar', 1010, 'Boa Viagem', 'Recife', 'PE', '5102102'),
            (5, 'Rua da Aurora', 200, 'Boa Vista', 'Recife', 'PE', '5005000'),
            (6, 'Av. Caxangá', 3500, 'Iputinga', 'Recife', 'PE', '5067000')
            ON CONFLICT (id_adress) DO NOTHING;
            SELECT setval('address_id_adress_seq', COALESCE((SELECT MAX(id_adress) FROM address), 1));
        </sql>
    </changeSet>

    <changeSet id="3.0-seed-employees" author="gobarber" context="dev">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM employee WHERE id_user = 1</sqlCheck>
        </preConditions>
        <comment>Senha de todos os usuários: password</comment>
        <sql>
            INSERT INTO employee (id_user, email, password, id_role) VALUES
            (1, 'admin@gobarber.com', '$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG', 1),
            (2, 'carlos.barbeiro@gobarber.com', '$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG', 2),
            (3, 'joao.barbeiro@gobarber.com', '$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG', 2),
            (4, 'pedro.barbeiro@gobarber.com', '$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG', 2),
            (5, 'lucas.barbeiro@gobarber.com', '$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG', 2),
            (6, 'ana.secretaria@gobarber.com', '$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG', 3),
            (7, 'maria.secretaria@gobarber.com', '$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG', 3)
            ON CONFLICT (id_user) DO NOTHING;
            SELECT setval('employee_id_user_seq', COALESCE((SELECT MAX(id_user) FROM employee), 1));
        </sql>
    </changeSet>

    <changeSet id="3.0-seed-services" author="gobarber" context="dev">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM service WHERE id_service = 1</sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO service (id_service, name_service, description_service, price_service, time_service) VALUES
            (1, 'Corte Masculino', 'Corte tradicional masculino com máquina e tesoura', 35.00, '00:30:00'),
            (2, 'Corte Degradê', 'Corte degradê americano ou europeu', 45.00, '00:45:00'),
            (3, 'Barba Completa', 'Barba com navalha, toalha quente e hidratação', 30.00, '00:30:00'),
            (4, 'Corte + Barba', 'Combo de corte masculino com barba completa', 55.00, '01:00:00'),
            (5, 'Pigmentação', 'Pigmentação capilar para disfarçar falhas', 80.00, '01:30:00'),
            (6, 'Sobrancelha', 'Design de sobrancelha masculina', 15.00, '00:15:00'),
            (7, 'Hidratação Capilar', 'Tratamento de hidratação profunda', 40.00, '00:30:00'),
            (8, 'Relaxamento', 'Relaxamento capilar para cabelos crespos', 60.00, '01:00:00'),
            (9, 'Platinado', 'Descoloração e platinado completo', 120.00, '02:00:00'),
            (10, 'Corte Infantil', 'Corte especial para crianças até 12 anos', 25.00, '00:20:00'),
            (11, 'Nevou', 'Efeito nevou no cabelo', 50.00, '00:45:00'),
            (12, 'Luzes', 'Mechas e luzes no cabelo', 100.00, '01:30:00')
            ON CONFLICT (id_service) DO NOTHING;
            SELECT setval('service_id_service_seq', COALESCE((SELECT MAX(id_service) FROM service), 1));
        </sql>
    </changeSet>

    <changeSet id="3.0-seed-barbers" author="gobarber" context="dev">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM barber WHERE id_barber = 1</sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO barber (id_barber, name_barber, cpf_barber, id_adress, salary, admission_date, workload, id_user, contact, start_working, end_working) VALUES
            (1, 'Carlos Silva', '12345678901', 1, 3500.00, '2023-01-15', 44, 2, '81999990001', '08:00:00', '18:00:00'),
            (2, 'João Santos', '12345678902', 2, 3200.00, '2023-03-20', 44, 3, '81999990002', '09:00:00', '19:00:00'),
            (3, 'Pedro Oliveira', '12345678903', 3, 3000.00, '2023-06-10', 40, 4, '81999990003', '08:00:00', '17:00:00'),
            (4, 'Lucas Ferreira', '12345678904', 4, 2800.00, '2024-01-05', 44, 5, '81999990004', '10:00:00', '20:00:00')
            ON CONFLICT (id_barber) DO NOTHING;
            SELECT setval('barber_id_barber_seq', COALESCE((SELECT MAX(id_barber) FROM barber), 1));
        </sql>
    </changeSet>

    <changeSet id="3.0-seed-secretaries" author="gobarber" context="dev">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM secretary WHERE id_secretary = 1</sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO secretary (id_secretary, name_secretary, cpf_secretary, id_adress, id_user, salary, admission_date, workload, contact, start_working, end_working) VALUES
            (1, 'Ana Costa', '98765432101', 5, 6, 2500.00, '2023-02-01', 44, '81988880001', '08:00:00', '17:00:00'),
            (2, 'Maria Souza', '98765432102', 6, 7, 2500.00, '2023-08-15', 44, '81988880002', '12:00:00', '21:00:00')
            ON CONFLICT (id_secretary) DO NOTHING;
            SELECT setval('secretary_id_secretary_seq', COALESCE((SELECT MAX(id_secretary) FROM secretary), 1));
        </sql>
    </changeSet>

    <changeSet id="3.0-seed-barber-services" author="gobarber" context="dev">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM barber_x_service WHERE id_barber = 1 AND id_service = 1</sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO barber_x_service (id_barber, id_service) VALUES
            (1, 1), (1, 2), (1, 3), (1, 4), (1, 6), (1, 10),
            (2, 1), (2, 2), (2, 3), (2, 4), (2, 5), (2, 9), (2, 11), (2, 12),
            (3, 1), (3, 2), (3, 3), (3, 4), (3, 6), (3, 7), (3, 10),
            (4, 1), (4, 2), (4, 3), (4, 4), (4, 7), (4, 8), (4, 5)
            ON CONFLICT DO NOTHING;
        </sql>
    </changeSet>

    <changeSet id="3.0-seed-products" author="gobarber" context="dev">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM product WHERE id_product = 1</sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO product (id_product, name_product, brand_product, price_product, size, description) VALUES
            (1, 'Pomada Modeladora Matte', 'Fox For Men', 45.00, '150g', 'Pomada efeito matte para fixação média'),
            (2, 'Pomada Modeladora Brilho', 'QOD', 55.00, '150g', 'Pomada com brilho para fixação forte'),
            (3, 'Cera Capilar', 'Bozzano', 35.00, '100g', 'Cera modeladora para cabelos curtos'),
            (4, 'Gel Fixador Forte', 'Duty', 25.00, '300g', 'Gel de fixação forte e duradoura'),
            (5, 'Óleo para Barba', 'Souvie', 60.00, '30ml', 'Óleo hidratante e modelador para barba'),
            (6, 'Balm para Barba', 'Viking', 50.00, '60g', 'Balm hidratante com fixação leve'),
            (7, 'Shampoo Anticaspa', 'Clear Men', 28.00, '400ml', 'Shampoo anticaspa para uso diário'),
            (8, 'Shampoo para Barba', 'Barba de Respeito', 40.00, '200ml', 'Shampoo específico para barba'),
            (9, 'Condicionador Masculino', 'Tresemmé', 22.00, '400ml', 'Condicionador para cabelos masculinos'),
            (10, 'Pós-Barba', 'Nivea', 30.00, '100ml', 'Loção pós-barba refrescante')
            ON CONFLICT (id_product) DO NOTHING;
            SELECT setval('product_id_product_seq', COALESCE((SELECT MAX(id_product) FROM product), 1));
        </sql>
    </changeSet>

    <changeSet id="3.0-seed-product-stock" author="gobarber" context="dev">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM product_stock WHERE batch_number = 'LOTE2024-001'</sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO product_stock (id_product, batch_number, quantity, expiration_date, acquisition_date) VALUES
            (1, 'LOTE2024-001', 25, '2026-06-15', '2024-06-15'),
            (2, 'LOTE2024-002', 20, '2026-06-15', '2024-06-15'),
            (3, 'LOTE2024-003', 15, '2026-03-20', '2024-03-20'),
            (4, 'LOTE2024-004', 30, '2025-12-31', '2024-01-15'),
            (5, 'LOTE2024-005', 18, '2026-08-10', '2024-08-10'),
            (6, 'LOTE2024-006', 12, '2026-08-10', '2024-08-10'),
            (7, 'LOTE2024-007', 40, '2025-09-30', '2024-03-30'),
            (8, 'LOTE2024-008', 22, '2026-05-15', '2024-05-15'),
            (9, 'LOTE2024-009', 35, '2025-11-20', '2024-05-20'),
            (10, 'LOTE2024-010', 28, '2026-02-28', '2024-08-28')
            ON CONFLICT DO NOTHING;
        </sql>
    </changeSet>

    <changeSet id="3.0-seed-sales" author="gobarber" context="dev">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM sale WHERE id_sale = 2</sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO sale (id_sale, sale_name, total_price, discount_coupon, start_date, end_date) VALUES
            (2, 'Promoção de Natal', 49.99, 'NATAL24', '2024-12-01', '2024-12-31'),
            (3, 'Black Friday', 39.99, 'BLACK24', '2024-11-25', '2024-11-30'),
            (4, 'Dia dos Pais', 44.99, 'PAPAI24', '2024-08-01', '2024-08-11'),
            (5, 'Volta às Aulas', 29.99, 'ESCOLA', '2025-01-15', '2025-02-15'),
            (6, 'Segunda Maluca', 34.99, 'SEGUNDA', '2024-01-01', '2025-12-31'),
            (7, 'Primeira Visita', 39.99, 'BEMVINDO', '2024-01-01', '2025-12-31'),
            (8, 'Indique um Amigo', 44.99, 'AMIGO10', '2024-01-01', '2025-12-31')
            ON CONFLICT (id_sale) DO NOTHING;
            SELECT setval('sale_id_sale_seq', COALESCE((SELECT MAX(id_sale) FROM sale), 1));
        </sql>
    </changeSet>

</databaseChangeLog>
